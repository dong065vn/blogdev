<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <title>Blog - ƒê√¥ng Dev</title>
  <meta name="description" content="Blog v·ªÅ l·∫≠p tr√¨nh, web development v√† c√¥ng ngh·ªá">
  <link rel="icon" href="../assets/favicon.png" type="image/png">
  
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Highlight.js for code syntax -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="../js/security.js"></script>
  
  <style>
    :root {
      --bg-dark: #0a0a14;
      --bg-darker: #050510;
      --bg-card: rgba(255, 255, 255, 0.04);
      --text-primary: #f5f5ff;
      --text-secondary: rgba(245, 245, 255, 0.75);
      --text-muted: rgba(245, 245, 255, 0.5);
      --neon-pink: #ff2d75;
      --neon-purple: #b14aed;
      --neon-blue: #00b4ff;
      --neon-cyan: #00ffea;
      --iris-purple: #a78bfa;
      --iris-cyan: #2dd4bf;
      --gradient-primary: linear-gradient(135deg, #ff2d75 0%, #b14aed 30%, #00b4ff 60%, #00ffea 100%);
      --font-heading: 'DM Sans', sans-serif;
      --font-body: 'DM Sans', sans-serif;
      --font-mono: 'Fira Code', monospace;
      --radius: 20px;
      --radius-sm: 12px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--font-body);
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.8;
      min-height: 100vh;
    }
    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; height: auto; }
    .container { max-width: 900px; margin: 0 auto; padding: 0 24px; }

    /* Background */
    .mesh-bg {
      position: fixed; inset: 0; z-index: 0;
      background: linear-gradient(135deg, #0a0a14 0%, #0f0f1a 50%, #050510 100%);
    }
    .mesh-bg::before {
      content: ''; position: absolute; inset: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(177, 74, 237, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0, 180, 255, 0.06) 0%, transparent 50%);
    }

    /* Header */
    .blog-header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      background: rgba(10, 10, 20, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      padding: 16px 0;
    }
    .blog-header .container {
      display: flex; align-items: center; justify-content: space-between;
      max-width: 1200px;
    }
    .back-link {
      display: flex; align-items: center; gap: 8px;
      color: var(--text-secondary); font-weight: 500;
      transition: color 0.3s;
    }
    .back-link:hover { color: var(--neon-cyan); }
    .logo {
      font-family: var(--font-heading); font-size: 1.3rem; font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    /* Article */
    .article-wrapper {
      position: relative; z-index: 1;
      padding: 120px 0 80px;
    }
    .article-header {
      text-align: center; margin-bottom: 48px;
    }
    .article-category {
      display: inline-block; padding: 6px 16px;
      background: rgba(177, 74, 237, 0.15);
      border: 1px solid rgba(177, 74, 237, 0.3);
      border-radius: 100px; font-size: 0.8rem; font-weight: 600;
      color: var(--iris-purple); text-transform: uppercase;
      margin-bottom: 20px;
    }
    .article-title {
      font-family: var(--font-heading);
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 800; line-height: 1.2;
      margin-bottom: 24px;
    }
    .article-meta {
      display: flex; align-items: center; justify-content: center;
      gap: 24px; flex-wrap: wrap;
      color: var(--text-muted); font-size: 0.9rem;
    }
    .article-meta span { display: flex; align-items: center; gap: 8px; }
    .article-meta i { color: var(--iris-purple); }
    .author-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.1);
      object-fit: cover; object-position: center 20%; /* Focus khu√¥n m·∫∑t */
    }

    /* Featured Image */
    .article-image {
      width: 100%; aspect-ratio: 16/9;
      border-radius: var(--radius);
      overflow: hidden; margin-bottom: 48px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    }
    .article-image img {
      width: 100%; height: 100%; object-fit: cover; object-position: center center;
    }
    /* ·∫¢nh c√≥ ng∆∞·ªùi - focus ph·∫ßn tr√™n */
    .article-image.has-person img { object-position: center 25%; }
    .article-image.has-face img { object-position: center 15%; }
    
    /* Image Focus Utilities */
    .img-focus-face { object-position: center 20% !important; }
    .img-focus-top { object-position: center top !important; }
    .img-focus-center { object-position: center center !important; }
    .img-focus-portrait { object-position: center 30% !important; }

    /* Content */
    .article-content {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      padding: 48px;
    }
    .article-content h2 {
      font-family: var(--font-heading);
      font-size: 1.8rem; font-weight: 700;
      margin: 40px 0 20px;
      color: var(--text-primary);
    }
    .article-content h2:first-child { margin-top: 0; }
    .article-content h3 {
      font-size: 1.3rem; font-weight: 600;
      margin: 32px 0 16px;
      color: var(--iris-cyan);
    }
    .article-content p {
      margin-bottom: 20px;
      color: var(--text-secondary);
    }
    .article-content ul, .article-content ol {
      margin: 16px 0 24px 24px;
      color: var(--text-secondary);
    }
    .article-content li { margin-bottom: 8px; }
    .article-content strong { color: var(--text-primary); }
    .article-content a {
      color: var(--neon-cyan);
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .article-content a:hover { color: var(--neon-pink); }

    /* Code blocks */
    .article-content pre {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      padding: 20px;
      margin: 24px 0;
      overflow-x: auto;
    }
    .article-content code {
      font-family: var(--font-mono);
      font-size: 0.9rem;
    }
    .article-content p code {
      background: rgba(177, 74, 237, 0.15);
      padding: 2px 8px;
      border-radius: 4px;
      color: var(--iris-purple);
    }

    /* Tags */
    .article-tags {
      display: flex; flex-wrap: wrap; gap: 10px;
      margin-top: 40px; padding-top: 32px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
    }
    .tag {
      padding: 8px 16px;
      background: rgba(0, 180, 255, 0.1);
      border: 1px solid rgba(0, 180, 255, 0.2);
      border-radius: 100px;
      font-size: 0.85rem; color: var(--iris-cyan);
    }

    /* Share */
    .article-share {
      display: flex; align-items: center; gap: 16px;
      margin-top: 24px;
    }
    .article-share span { color: var(--text-muted); font-size: 0.9rem; }
    .share-btn {
      width: 44px; height: 44px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      transition: all 0.3s;
    }
    .share-btn:hover {
      background: rgba(177, 74, 237, 0.15);
      border-color: var(--iris-purple);
      color: var(--text-primary);
    }

    /* Table of Contents */
    .toc-wrapper {
      position: relative;
    }
    .toc-container {
      position: sticky;
      top: 100px;
      max-height: calc(100vh - 140px);
      overflow-y: auto;
      padding: 24px;
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      margin-bottom: 24px;
    }
    .toc-container::-webkit-scrollbar {
      width: 4px;
    }
    .toc-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }
    .toc-container::-webkit-scrollbar-thumb {
      background: rgba(177, 74, 237, 0.3);
      border-radius: 4px;
    }
    .toc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    .toc-title {
      font-family: var(--font-heading);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .toc-title i {
      color: var(--iris-purple);
      font-size: 0.85rem;
    }
    .toc-toggle {
      display: none;
      width: 28px;
      height: 28px;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s;
    }
    .toc-toggle:hover {
      background: rgba(177, 74, 237, 0.15);
      color: var(--text-primary);
    }
    .toc-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .toc-list li {
      margin-bottom: 4px;
    }
    .toc-link {
      display: block;
      padding: 8px 12px;
      font-size: 0.85rem;
      color: var(--text-muted);
      border-radius: 8px;
      border-left: 2px solid transparent;
      transition: all 0.3s;
      line-height: 1.4;
    }
    .toc-link:hover {
      color: var(--text-primary);
      background: rgba(255, 255, 255, 0.05);
    }
    .toc-link.active {
      color: var(--neon-cyan);
      background: rgba(0, 255, 234, 0.08);
      border-left-color: var(--neon-cyan);
    }
    .toc-link.toc-h3 {
      padding-left: 24px;
      font-size: 0.8rem;
    }
    .toc-progress {
      position: absolute;
      top: 0;
      left: 0;
      width: 3px;
      height: 0%;
      background: linear-gradient(180deg, var(--neon-purple), var(--neon-cyan));
      border-radius: 3px;
      transition: height 0.1s;
    }
    
    /* Article layout with TOC */
    .article-layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 40px;
      align-items: start;
    }
    .article-main {
      min-width: 0;
    }
    
    /* Mobile TOC */
    .toc-mobile {
      display: none;
      margin-bottom: 24px;
    }
    .toc-mobile .toc-container {
      position: relative;
      top: 0;
      max-height: none;
    }
    .toc-mobile .toc-list {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .toc-mobile.expanded .toc-list {
      max-height: 500px;
    }
    .toc-mobile .toc-toggle {
      display: flex;
    }
    .toc-mobile .toc-toggle i {
      transition: transform 0.3s;
    }
    .toc-mobile.expanded .toc-toggle i {
      transform: rotate(180deg);
    }
    
    /* Reading progress bar */
    .reading-progress {
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-purple), var(--neon-cyan));
      z-index: 1000;
      transition: width 0.1s;
    }

    @media (max-width: 1100px) {
      .article-layout {
        grid-template-columns: 1fr;
      }
      .toc-sidebar {
        display: none;
      }
      .toc-mobile {
        display: block;
      }
    }

    /* Related Posts */
    .related-section {
      margin-top: 80px;
    }
    .related-title {
      font-family: var(--font-heading);
      font-size: 1.5rem; font-weight: 700;
      margin-bottom: 32px;
    }
    .related-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
    }
    .related-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    .related-card:hover {
      transform: translateY(-12px) scale(1.02);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 24px 64px rgba(0, 0, 0, 0.4), 0 0 20px rgba(177, 74, 237, 0.5);
    }
    .related-card img {
      width: 100%; aspect-ratio: 16/9; object-fit: cover; object-position: center center;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .related-card:hover img {
      transform: scale(1.1);
    }
    .related-card h4 {
      transition: color 0.3s ease;
    }
    .related-card:hover h4 {
      color: var(--iris-purple);
    }
    .related-card.has-person img { object-position: center 25%; }
    .related-card.has-face img { object-position: center 15%; }
    .related-card-content {
      padding: 20px;
    }
    .related-card h4 {
      font-size: 1rem; font-weight: 600;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .related-card p {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    /* Footer */
    .blog-footer {
      text-align: center;
      padding: 40px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      margin-top: 80px;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Loading */
    .loading {
      display: flex; align-items: center; justify-content: center;
      min-height: 400px;
      color: var(--text-muted);
    }
    .loading i { font-size: 2rem; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Responsive - Tablet */
    @media (max-width: 768px) {
      .container { padding: 0 16px; }
      .article-wrapper { padding: 100px 0 60px; }
      .article-header { margin-bottom: 32px; }
      .article-title { margin-bottom: 16px; }
      .article-meta { gap: 12px; font-size: 0.85rem; }
      .article-image { margin-bottom: 32px; border-radius: 16px; }
      .article-content { 
        padding: 24px; 
        border-radius: 16px;
      }
      .article-content h2 { font-size: 1.5rem; margin: 32px 0 16px; }
      .article-content h3 { font-size: 1.15rem; margin: 24px 0 12px; }
      .article-content pre { padding: 16px; margin: 20px 0; }
      .article-tags { margin-top: 32px; padding-top: 24px; }
      .related-section { margin-top: 60px; }
      .related-title { font-size: 1.3rem; margin-bottom: 24px; }
      .related-grid { gap: 16px; }
      .blog-footer { margin-top: 60px; padding: 32px 0; }
    }

    /* Responsive - Mobile */
    @media (max-width: 480px) {
      .container { padding: 0 12px; }
      .blog-header { padding: 12px 0; }
      .back-link { font-size: 0.9rem; }
      .back-link span { display: none; }
      .logo { font-size: 1.1rem; }
      .article-wrapper { padding: 90px 0 40px; }
      .article-header { margin-bottom: 24px; }
      .article-category { 
        padding: 5px 12px; 
        font-size: 0.75rem; 
        margin-bottom: 16px; 
      }
      .article-title { 
        font-size: 1.5rem; 
        margin-bottom: 12px;
        line-height: 1.3;
      }
      .article-meta { 
        flex-direction: column; 
        gap: 8px; 
        font-size: 0.8rem;
      }
      .author-avatar { width: 32px; height: 32px; }
      .article-image { 
        margin-bottom: 24px; 
        border-radius: 12px;
        aspect-ratio: 4/3;
      }
      .article-content { 
        padding: 16px; 
        border-radius: 12px;
      }
      .article-content h2 { font-size: 1.3rem; margin: 28px 0 12px; }
      .article-content h3 { font-size: 1.1rem; margin: 20px 0 10px; }
      .article-content p { font-size: 0.95rem; margin-bottom: 16px; }
      .article-content pre { 
        padding: 12px; 
        margin: 16px -16px;
        border-radius: 0;
        font-size: 0.8rem;
      }
      .article-content code { font-size: 0.8rem; }
      .article-content ul, .article-content ol { margin-left: 16px; }
      .article-tags { 
        margin-top: 24px; 
        padding-top: 20px; 
        gap: 8px;
      }
      .tag { padding: 6px 12px; font-size: 0.8rem; }
      .article-share { 
        flex-wrap: wrap; 
        gap: 12px;
        margin-top: 20px;
      }
      .share-btn { width: 40px; height: 40px; }
      .toc-mobile .toc-container { padding: 16px; }
      .toc-link { padding: 6px 10px; font-size: 0.8rem; }
      .toc-link.toc-h3 { padding-left: 20px; font-size: 0.75rem; }
      .related-section { margin-top: 48px; }
      .related-title { font-size: 1.2rem; margin-bottom: 20px; }
      .related-grid { 
        grid-template-columns: 1fr; 
        gap: 12px;
      }
      .related-card-content { padding: 16px; }
      .related-card h4 { font-size: 0.95rem; }
      .blog-footer { 
        margin-top: 48px; 
        padding: 24px 0;
        font-size: 0.85rem;
      }
    }

    /* Safe area for notch devices */
    @supports (padding: max(0px)) {
      .blog-header {
        padding-left: max(16px, env(safe-area-inset-left));
        padding-right: max(16px, env(safe-area-inset-right));
      }
      .blog-footer {
        padding-bottom: max(24px, env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>
  <div class="reading-progress" id="readingProgress"></div>
  <div class="mesh-bg"></div>

  <header class="blog-header">
    <div class="container">
      <a href="../index.html#blog" class="back-link">
        <i class="fa-solid fa-arrow-left"></i> Quay l·∫°i
      </a>
      <a href="../index.html" class="logo">ƒê√îNG.</a>
    </div>
  </header>

  <main class="article-wrapper">
    <div class="container">
      <article id="article">
        <div class="loading">
          <i class="fa-solid fa-spinner"></i>
        </div>
      </article>
    </div>
  </main>

  <footer class="blog-footer">
    <div class="container">
      <p>¬© 2025 ƒê√¥ng Dev. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script type="module">
    // Get post ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');

    // Helper functions
    function escapeHtml(str) {
      if (!str) return '';
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('vi-VN', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    }

    // Load and render post
    async function loadPost() {
      try {
        // Try Firebase first
        let posts = null;
        try {
          const { initializeApp, getApps } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
          const { getDatabase, ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          
          const firebaseConfig = {
            apiKey: "AIzaSyDCls_5XeIw5LbAP7wsjcaffeG6_1sCAzY",
            authDomain: "dbblogdev.firebaseapp.com",
            databaseURL: "https://dbblogdev-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "dbblogdev"
          };
          
          let app = getApps()[0];
          if (!app) app = initializeApp(firebaseConfig);
          const database = getDatabase(app);
          
          const snapshot = await get(ref(database, 'posts'));
          if (snapshot.exists()) {
            const data = snapshot.val();
            posts = Object.values(data).sort((a, b) => new Date(b.date) - new Date(a.date));
            console.log('Posts loaded from Firebase:', posts.length);
          }
        } catch (fbErr) {
          console.warn('Firebase error:', fbErr);
        }
        
        // Fallback to local JSON
        if (!posts || posts.length === 0) {
          const response = await fetch('posts.json');
          const data = await response.json();
          posts = data.posts;
          console.log('Posts loaded from local JSON:', posts.length);
        }
        
        const post = posts.find(p => p.id === postId);

        if (!post) {
          document.getElementById('article').innerHTML = `
            <div class="article-header">
              <h1 class="article-title">B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i</h1>
              <p style="color: var(--text-muted);">B√†i vi·∫øt b·∫°n t√¨m ki·∫øm kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã x√≥a.</p>
              <a href="../index.html#blog" style="color: var(--neon-cyan); margin-top: 20px; display: inline-block;">
                ‚Üê Quay l·∫°i trang ch·ªß
              </a>
            </div>
          `;
          return;
        }

        // Ki·ªÉm tra quy·ªÅn hi·ªÉn th·ªã - ch·ªâ cho xem b√†i public
        // B√†i private/draft c·∫ßn ƒëƒÉng nh·∫≠p admin
        if (post.visibility && post.visibility !== 'public') {
          document.getElementById('article').innerHTML = `
            <div class="article-header">
              <h1 class="article-title">üîí B√†i vi·∫øt kh√¥ng kh·∫£ d·ª•ng</h1>
              <p style="color: var(--text-muted);">B√†i vi·∫øt n√†y ${post.visibility === 'draft' ? 'ƒëang ·ªü ch·∫ø ƒë·ªô b·∫£n nh√°p' : 'ƒë∆∞·ª£c ƒë·∫∑t ·ªü ch·∫ø ƒë·ªô ri√™ng t∆∞'} v√† kh√¥ng th·ªÉ xem c√¥ng khai.</p>
              <a href="../index.html#blog" style="color: var(--neon-cyan); margin-top: 20px; display: inline-block;">
                ‚Üê Quay l·∫°i trang ch·ªß
              </a>
            </div>
          `;
          return;
        }

        // Update page title
        document.title = `${post.title} - ƒê√¥ng Dev`;

        // Get related posts (same category, exclude current, only public)
        const relatedPosts = posts
          .filter(p => p.id !== post.id && (!p.visibility || p.visibility === 'public'))
          .slice(0, 3);

        // Render article with content
        const contentHtml = marked.parse(post.content || '');
        
        document.getElementById('article').innerHTML = `
          <header class="article-header">
            <span class="article-category">${escapeHtml(post.category)}</span>
            <h1 class="article-title">${escapeHtml(post.title)}</h1>
            <div class="article-meta">
              <span>
                <img src="../assets/avatar.jpg" alt="${escapeHtml(post.author)}" class="author-avatar">
                ${escapeHtml(post.author)}
              </span>
              <span><i class="fa-regular fa-calendar"></i> ${formatDate(post.date)}</span>
              <span><i class="fa-regular fa-clock"></i> ${post.readTime} ph√∫t ƒë·ªçc</span>
            </div>
          </header>

          <div class="article-image">
            <img src="${post.image}" alt="${escapeHtml(post.title)}">
          </div>

          <!-- Mobile TOC -->
          <div class="toc-mobile" id="tocMobile">
            <div class="toc-container">
              <div class="toc-header">
                <span class="toc-title"><i class="fa-solid fa-list"></i> M·ª•c l·ª•c</span>
                <button class="toc-toggle" onclick="toggleMobileToc()">
                  <i class="fa-solid fa-chevron-down"></i>
                </button>
              </div>
              <ul class="toc-list" id="tocListMobile"></ul>
            </div>
          </div>

          <div class="article-layout">
            <!-- Sidebar TOC -->
            <aside class="toc-sidebar toc-wrapper">
              <div class="toc-container">
                <div class="toc-progress" id="tocProgress"></div>
                <div class="toc-header">
                  <span class="toc-title"><i class="fa-solid fa-list"></i> M·ª•c l·ª•c</span>
                </div>
                <ul class="toc-list" id="tocList"></ul>
              </div>
            </aside>

            <!-- Main Content -->
            <div class="article-main">
              <div class="article-content" id="articleContent">
                ${contentHtml}
                
                <div class="article-tags">
                  ${(post.tags || []).map(tag => `<span class="tag">#${tag}</span>`).join('')}
                </div>

                <div class="article-share">
                  <span>Chia s·∫ª:</span>
                  <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}" 
                     target="_blank" class="share-btn" aria-label="Share on Facebook">
                    <i class="fa-brands fa-facebook-f"></i>
                  </a>
                  <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(post.title)}" 
                     target="_blank" class="share-btn" aria-label="Share on Twitter">
                    <i class="fa-brands fa-x-twitter"></i>
                  </a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(window.location.href)}&title=${encodeURIComponent(post.title)}" 
                     target="_blank" class="share-btn" aria-label="Share on LinkedIn">
                    <i class="fa-brands fa-linkedin-in"></i>
                  </a>
                </div>
              </div>

              ${relatedPosts.length > 0 ? `
                <section class="related-section">
                  <h3 class="related-title">B√†i vi·∫øt li√™n quan</h3>
                  <div class="related-grid">
                    ${relatedPosts.map(p => `
                      <a href="post.html?id=${p.id}" class="related-card">
                        <img src="${p.image}" alt="${p.title}">
                        <div class="related-card-content">
                          <h4>${p.title}</h4>
                          <p>${p.readTime} ph√∫t ƒë·ªçc</p>
                        </div>
                      </a>
                    `).join('')}
                  </div>
                </section>
              ` : ''}
            </div>
          </div>
        `;

        // Generate TOC
        generateTOC();

        // Highlight code blocks
        document.querySelectorAll('pre code').forEach(block => {
          hljs.highlightElement(block);
        });

        // Setup scroll tracking
        setupScrollTracking();

      } catch (error) {
        console.error('Error loading post:', error);
        document.getElementById('article').innerHTML = `
          <div class="article-header">
            <h1 class="article-title">L·ªói t·∫£i b√†i vi·∫øt</h1>
            <p style="color: var(--text-muted);">ƒê√£ x·∫£y ra l·ªói khi t·∫£i b√†i vi·∫øt. Vui l√≤ng th·ª≠ l·∫°i sau.</p>
          </div>
        `;
      }
    }

    loadPost();

    // Generate Table of Contents
    function generateTOC() {
      const content = document.getElementById('articleContent');
      if (!content) return;

      const headings = content.querySelectorAll('h2, h3');
      if (headings.length === 0) {
        // Hide TOC if no headings
        const tocSidebar = document.querySelector('.toc-sidebar');
        const tocMobile = document.getElementById('tocMobile');
        if (tocSidebar) tocSidebar.style.display = 'none';
        if (tocMobile) tocMobile.style.display = 'none';
        
        // Reset layout to single column
        const layout = document.querySelector('.article-layout');
        if (layout) layout.style.gridTemplateColumns = '1fr';
        return;
      }

      const tocList = document.getElementById('tocList');
      const tocListMobile = document.getElementById('tocListMobile');
      let tocHtml = '';

      headings.forEach((heading, index) => {
        // Add ID to heading for anchor
        const id = `heading-${index}`;
        heading.id = id;

        const level = heading.tagName.toLowerCase();
        const text = heading.textContent;

        tocHtml += `
          <li>
            <a href="#${id}" class="toc-link toc-${level}" data-target="${id}">
              ${text}
            </a>
          </li>
        `;
      });

      if (tocList) tocList.innerHTML = tocHtml;
      if (tocListMobile) tocListMobile.innerHTML = tocHtml;

      // Add click handlers for smooth scroll
      document.querySelectorAll('.toc-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = link.getAttribute('data-target');
          const target = document.getElementById(targetId);
          if (target) {
            const offset = 100; // Header height
            const top = target.getBoundingClientRect().top + window.pageYOffset - offset;
            window.scrollTo({ top, behavior: 'smooth' });
            
            // Close mobile TOC after click
            const tocMobile = document.getElementById('tocMobile');
            if (tocMobile && tocMobile.classList.contains('expanded')) {
              tocMobile.classList.remove('expanded');
            }
          }
        });
      });
    }

    // Toggle mobile TOC
    window.toggleMobileToc = function() {
      const tocMobile = document.getElementById('tocMobile');
      if (tocMobile) {
        tocMobile.classList.toggle('expanded');
      }
    };

    // Setup scroll tracking for active TOC item and reading progress
    function setupScrollTracking() {
      const content = document.getElementById('articleContent');
      if (!content) return;

      const headings = content.querySelectorAll('h2, h3');
      const tocLinks = document.querySelectorAll('.toc-link');
      const readingProgress = document.getElementById('readingProgress');
      const tocProgress = document.getElementById('tocProgress');

      if (headings.length === 0) return;

      function updateActiveHeading() {
        const scrollPos = window.scrollY + 150;

        // Find current heading
        let currentHeading = null;
        headings.forEach(heading => {
          if (heading.offsetTop <= scrollPos) {
            currentHeading = heading;
          }
        });

        // Update active class
        tocLinks.forEach(link => {
          link.classList.remove('active');
          if (currentHeading && link.getAttribute('data-target') === currentHeading.id) {
            link.classList.add('active');
          }
        });
      }

      function updateReadingProgress() {
        const article = document.querySelector('.article-wrapper');
        if (!article) return;

        const articleTop = article.offsetTop;
        const articleHeight = article.offsetHeight;
        const windowHeight = window.innerHeight;
        const scrollPos = window.scrollY;

        // Calculate progress
        const start = articleTop;
        const end = articleTop + articleHeight - windowHeight;
        const progress = Math.min(Math.max((scrollPos - start) / (end - start) * 100, 0), 100);

        if (readingProgress) {
          readingProgress.style.width = `${progress}%`;
        }
        if (tocProgress) {
          tocProgress.style.height = `${progress}%`;
        }
      }

      // Throttle scroll events
      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            updateActiveHeading();
            updateReadingProgress();
            ticking = false;
          });
          ticking = true;
        }
      });

      // Initial update
      updateActiveHeading();
      updateReadingProgress();
    }
  </script>
</body>
</html>